{"version":3,"file":"chatbot.component.core.js","sourceRoot":"","sources":["../../../../../src/components/interactions/chatbot/chatbot.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n// tslint:enable\n\nimport { Component, Input, Output, EventEmitter, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { AmplifyService } from '../../../providers/amplify.service';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport { isUndefined } from 'util';\nrequire('./aws-lex-audio.js')\n\nconst logger = new Logger('ChatBot');\n\nconst template = `\n<div class=\"amplify-interactions\">\n\t<div class=\"amplify-interactions-container\">\n\t\t<div class=\"amplify-form-container\">\n\t\t\t<div class=\"amplify-form-row\">\n\t\t\t\t<div class=\"amplify-interactions-conversation\">\n\t\t\t\t\t<div *ngFor=\"let message of messages\">\n\t\t\t\t\t\t<div class=\"amplify-interactions-input\">{{message.me}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-input-timestamp\">{{message.meSentTime}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response\">{{message.bot}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response-timestamp\">{{message.botSentTime}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"amplify-interactions-actions\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[value]=\"inputText\"\n\t\t\t\t\t(keyup.enter)=\"onSubmit(inputValue.value)\"\n\t\t\t\t\t(change)=\"onInputChange($event.target.value)\"\n\t\t\t\t\t[disabled]=\"inputDisabled\"\n\t\t\t\t\t*ngIf=\"textEnabled\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[disabled]=\"!textEnabled\"\n\t\t\t\t\t*ngIf=\"!textEnabled\">\n\n\t\t\t\t<button type=\"button\" *ngIf=\"voiceEnabled\" ng-style=\"{float: 'right'}\" (click)=\"micButtonHandler()\" [disabled]=\"micButtonDisabled\">{{micText}}</button>\n\t\t\t\t<button type=\"button\" *ngIf=\"textEnabled\" ng-style=\"{float: 'right'}\" class=\"amplify-interactions-button\" [disabled]=\"inputDisabled\" ng-click=\"!inputDisabled || onSubmit(inputValue.value)\"></button>\n\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n`;\ndeclare var LexAudio: any;\n\nlet STATES = {\n\tINITIAL: { MESSAGE: 'Type your message or click  🎤', ICON: '🎤' },\n\tLISTENING: { MESSAGE: 'Listening... click 🔴 again to cancel', ICON: '🔴' },\n\tSENDING: { MESSAGE: 'Please wait...', ICON: '🔊' },\n\tSPEAKING: { MESSAGE: 'Speaking...', ICON: '...' }\n};\n\nconst defaultVoiceConfig = {\n\tsilenceDetectionConfig: {\n\t\ttime: 2000,\n\t\tamplitude: 0.2\n\t}\n}\n\n@Component({\n\tselector: 'amplify-interactions-core',\n\ttemplate: template\n})\nexport class ChatbotComponentCore {\n\terrorMessage: string;\n\tamplifyService: AmplifyService;\n\tinputText: string = \"\";\n\tbotName: string;\n\tchatTitle: string;\n\tclearComplete: boolean = false;\n\tmessages: any = [];\n\tcompletions: any = {};\n\tcurrentVoiceState: string = STATES.INITIAL.MESSAGE;\n\tinputDisabled: boolean = false;\n\tmicText: string = STATES.INITIAL.ICON;\n\tvoiceConfig: any = defaultVoiceConfig;\n\tcontinueConversation: boolean = false;\n\tmicButtonDisabled: boolean = false;\n\taudioInput: any;\n\tlexResponse: any;\n\tconversationModeOn: boolean = false;\n\tref: ChangeDetectorRef;\n\tvoiceEnabled: boolean = false;\n\ttextEnabled: boolean = true;\n\taudioControl: any;\n\n\t@Output()\n\tcomplete: EventEmitter<string> = new EventEmitter<string>();\n\n\tconstructor(ref: ChangeDetectorRef, amplifyService: AmplifyService) {\n\t\tthis.amplifyService = amplifyService;\n\t\tthis.ref = ref;\n\t\tthis.continueConversation = false;\n\t}\n\n\t@Input()\n\tset data(data: any) {\n\t\tthis.botName = data.bot;\n\t\tthis.chatTitle = data.title;\n\t\tthis.clearComplete = data.clearComplete;\n\t\tthis.conversationModeOn = isUndefined(data.conversationModeOn) ? false : data.conversationModeOn;\n\t\tthis.voiceEnabled = isUndefined(data.voiceEnabled) ? false : data.voiceEnabled;\n\t\tthis.textEnabled = isUndefined(data.textEnabled) ? true : data.textEnabled;\n\t\tthis.voiceConfig = data.voiceConfig || this.voiceConfig;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService.interactions().onComplete(this.botName, this.performOnComplete);\n\n\t\tif (!this.textEnabled && this.voiceEnabled) {\n\t\t\tthis.currentVoiceState = \"Click the mic button\"\n\t\t\tSTATES.INITIAL.MESSAGE = \"Click the mic button\"\n\t\t}\n\n\t\tif (!this.voiceEnabled && this.textEnabled) {\n\t\t\tthis.currentVoiceState = \"Type a message\"\n\t\t\tSTATES.INITIAL.MESSAGE = \"Type a message\"\n\t\t}\n\n\t\tif (this.voiceEnabled) {\n\t\t\tthis.audioControl = new LexAudio.audioControl();\n\t\t}\n\n\n\t}\n\n\n\t@Input()\n\tset bot(botName: string) {\n\t\tthis.botName = botName;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService.interactions().onComplete(botName, this.performOnComplete);\n\t}\n\n\t@Input()\n\tset title(title: string) {\n\t\tthis.chatTitle = title;\n\t}\n\n\t@Input()\n\tset clearOnComplete(clearComplete: boolean) {\n\t\tthis.clearComplete = clearComplete;\n\t}\n\n\tperformOnComplete(evt) {\n\t\tthis.complete.emit(evt);\n\t\tif (this.clearComplete) {\n\t\t\tthis.messages = [];\n\t\t}\n\t}\n\n\tonInputChange(value: string) {\n\t\tthis.inputText = value;\n\t}\n\n\tonSubmit(e) {\n\t\tif (!this.inputText) {\n\t\t\treturn;\n\t\t}\n\t\tlet message = {\n\t\t\t'me': this.inputText,\n\t\t\t'meSentTime': new Date().toLocaleTimeString(),\n\t\t\t'bot': '',\n\t\t\t'botSentTime': ''\n\t\t};\n\t\tthis.amplifyService.interactions().send(this.botName, this.inputText)\n\t\t\t.then((response: any) => {\n\t\t\t\tthis.inputText = \"\";\n\t\t\t\tmessage.bot = response.message;\n\t\t\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\t\t\tthis.messages.push(message);\n\t\t\t})\n\t\t\t.catch((error) => logger.error(error));\n\t}\n\n\tonSilenceHandler = () => {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tthis.audioControl.exportWAV((blob) => {\n\t\t\tthis.currentVoiceState = STATES.SENDING.MESSAGE;\n\t\t\tthis.audioInput = blob;\n\t\t\tthis.micText = STATES.SENDING.ICON;\n\t\t\tthis.micButtonDisabled = true;\n\t\t\tthis.lexResponseHandler();\n\t\t});\n\t\tthis.ref.detectChanges();\n\t}\n\n\treset() {\n\t\tthis.audioControl.clear();\n\t\tthis.inputText = '';\n\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\tthis.inputDisabled = false;\n\t\tthis.micText = STATES.INITIAL.ICON;\n\t\tthis.continueConversation = false;\n\t\tthis.micButtonDisabled = false;\n\t\tthis.ref.detectChanges();\n\t}\n\n\tonError(error) {\n\t\tlogger.error(error)\n\t}\n\n\tasync lexResponseHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\n        const interactionsMessage = {\n            content: this.audioInput,\n            options: {\n                messageType: 'voice'\n            }\n\t\t};\n\t\t\n\t\tconst response = await this.amplifyService.interactions().send(this.botName, interactionsMessage);\n\n\t\tthis.lexResponse = response;\n\t\tthis.currentVoiceState = STATES.SPEAKING.MESSAGE;\n\t\tthis.micText = STATES.SPEAKING.ICON;\n\t\tthis.micButtonDisabled = true;\n\n\t\tlet message = {\n\t\t\t'me': this.lexResponse.inputTranscript,\n\t\t\t'meSentTime': new Date().toLocaleTimeString(),\n\t\t\t'bot': '',\n\t\t\t'botSentTime': ''\n\t\t};\n\n\t\tthis.inputText = \"\";\n\t\tmessage.bot = this.lexResponse.message;\n\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\tthis.messages.push(message);\n\t\tthis.doneSpeakingHandler();\n\t\tthis.ref.detectChanges();\n\t}\n\n\tdoneSpeakingHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.lexResponse.contentType === 'audio/mpeg') {\n\t\t\tthis.audioControl.play(this.lexResponse.audioStream, () => {\n\t\t\t\tif (this.lexResponse.dialogState === 'ReadyForFulfillment' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Fulfilled' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Failed' ||\n\t\t\t\t\t!this.conversationModeOn) {\n\t\t\t\t\tthis.inputDisabled = false;\n\t\t\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.continueConversation = false;\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t} else {\n\t\t\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.audioControl.startRecording(this.onSilenceHandler, null, this.voiceConfig.silenceDetectionConfig);\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.inputDisabled = false;\n\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.continueConversation = false;\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n\n\tasync micButtonHandler() {\n\t\tif (this.continueConversation) {\n\t\t\tthis.reset();\n\t\t\tthis.ref.detectChanges();\n\t\t} else {\n\t\t\tthis.inputDisabled = true;\n\t\t\tthis.continueConversation = true;\n\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.audioControl.startRecording(this.onSilenceHandler, null, this.voiceConfig.silenceDetectionConfig);\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n\n}\n"]}